<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 8.3 - Native APIs Demo</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .button {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      transition: all 0.3s ease;
    }
    
    .button:hover {
      background: white;
      color: #4CAF50;
      transform: translateY(-2px);
    }
    
    .result-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .file-content {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
    }
    
    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      box-sizing: border-box;
    }
    
    .loading { color: #FFD700; }
    .success { color: #90EE90; }
    .error { color: #FF6B6B; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üñ•Ô∏è Native APIs Demo</h1>
      <p>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Native APIs ‡∏Ç‡∏≠‡∏á Operating System</p>
    </div>

    <!-- File Operations Section -->
    <div class="section">
      <h3>üìÅ File Operations</h3>
      <p>‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢ OS dialogs</p>
      
      <button class="button" onclick="openFile()">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</button>
      <button class="button" onclick="exportAgentData()">üìä Export Agent Data</button>
      <button class="button" onclick="saveCurrentContent()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
      
      <div class="result-box" id="fileResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö file operations</div>
      
      <div id="fileContent" class="file-content" style="display: none;"></div>
    </div>

    <!-- Notifications Section -->
    <div class="section">
        <h3>üîî Desktop Notifications</h3>
        <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Operating System</p>
  
        <button class="button" onclick="testBasicNotification()">üîî ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Notification</button>
        <button class="button" onclick="testAgentLogin()">üü¢ Agent Login</button>
        <button class="button" onclick="testCallReceived()">üìû Call Received</button>
        <button class="button" onclick="testUrgentAlert()">üö® Urgent Alert</button>
  
        <div class="result-box" id="notificationResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö notifications</div>
    </div>

    <!-- Text Editor Section -->
    <div class="section">
            <h3>üìù Text Editor</h3>
            <p>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå</p>
      
            <textarea id="textEditor" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà... ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ">
        # Agent Report
        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH')}

        ## ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agents
        - Agent ID: AG001
        - ‡∏ä‡∏∑‡πà‡∏≠: Alice Johnson  
        - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Available
        - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏¢: 15 calls
        - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: 245 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

        ## ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        - Total Calls: 35
        - Avg Wait Time: 45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        - Available Agents: 1 ‡∏Ñ‡∏ô
        - Busy Agents: 1 ‡∏Ñ‡∏ô
            </textarea>
            </div>
            <!-- System Tray Section -->
        <div class="section">
        <h3>üñ±Ô∏è System Tray Integration</h3>
        <p>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° app ‡∏ú‡πà‡∏≤‡∏ô system tray (‡∏ñ‡∏≤‡∏î‡∏£‡∏∞‡∏ö‡∏ö)</p>
  
        <button class="button" onclick="testHideToTray()">üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ Tray</button>
        <button class="button" onclick="testTrayNotification()">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å Tray</button>
  
        <div class="result-box" id="trayResult">
        ‚ÑπÔ∏è System Tray Features:
        ‚Ä¢ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà icon ‡πÉ‡∏ô taskbar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
        ‚Ä¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ agent ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray menu
        ‚Ä¢ ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á app ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray
        ‚Ä¢ ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray menu

        üí° ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î window ‡∏ô‡∏µ‡πâ - ‡πÅ‡∏≠‡∏õ‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô system tray!
        </div>
    </div>
  </div>

  <script>
    console.log('üé® [RENDERER] Native APIs Demo ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß');

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API
    if (window.nativeAPI) {
      console.log('‚úÖ [RENDERER] Native APIs ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    } else {
      console.error('‚ùå [RENDERER] Native APIs ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    function showResult(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString('th-TH');
      
      element.innerHTML = `[${timestamp}] ${message}`;
      element.className = `result-box ${type}`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå
    async function openFile() {
      try {
        console.log('üìÇ [RENDERER] ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î file dialog...', 'loading');
        
        const result = await window.nativeAPI.openFile();
        
        if (result.success) {
          console.log('‚úÖ [RENDERER] ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result.fileName);
          
          showResult('fileResult', 
            `‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${result.filePath}\n` +
            `üìä ‡∏Ç‡∏ô‡∏≤‡∏î: ${result.size} characters`, 
            'success'
          );
          
          // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå
          const contentDiv = document.getElementById('fileContent');
          contentDiv.style.display = 'block';
          contentDiv.innerHTML = `<strong>üìÑ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå ${result.fileName}:</strong>\n\n${result.content}`;
          
          // ‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô text editor
          document.getElementById('textEditor').value = result.content;
          
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent
    async function exportAgentData() {
      try {
        console.log('üìä [RENDERER] ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Agent...', 'loading');
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV
        const agentData = [
          'Agent ID,Name,Status,Extension,Department,Total Calls,Avg Call Time',
          'AG001,Alice Johnson,Available,1001,Sales,15,245',
          'AG002,Bob Smith,Busy,1002,Support,8,312', 
          'AG003,Carol Lee,Break,1003,Sales,12,198'
        ].join('\n');
        
        const fileName = `agent-report-${new Date().toISOString().split('T')[0]}.csv`;
        
        const result = await window.nativeAPI.saveFile(agentData, fileName);
        
        if (result.success) {
          console.log('‚úÖ [RENDERER] ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result.fileName);
          
          showResult('fileResult',
            `üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${result.filePath}\n` +
            `üìà ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: 3 agents ‡πÉ‡∏ô CSV format`,
            'success'
          );
          
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    async function saveCurrentContent() {
      const content = document.getElementById('textEditor').value;
      
      if (!content.trim()) {
        showResult('fileResult', '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        return;
      }
      
      try {
        console.log('üíæ [RENDERER] ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå...', 'loading');
        
        const fileName = `my-document-${Date.now()}.txt`;
        const result = await window.nativeAPI.saveFile(content, fileName);
        
        if (result.success) {
          console.log('‚úÖ [RENDERER] ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result.fileName);
          
          showResult('fileResult',
            `üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${result.filePath}\n` +
            `üìä ‡∏Ç‡∏ô‡∏≤‡∏î: ${content.length} characters`,
            'success'
          );
          
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    // Event listeners
    window.addEventListener('DOMContentLoaded', () => {
      console.log('üìÑ [RENDERER] DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß');
      showResult('fileResult', '‚úÖ Native APIs Demo ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n\n‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö file operations', 'success');
    });

    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
async function testBasicNotification() {
  try {
    console.log('üîî [RENDERER] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification...');
    showResult('notificationResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á notification...', 'loading');
    
    const result = await window.nativeAPI.showNotification(
      'Agent Wallboard',
      '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ desktop notification ‡∏ó‡∏î‡∏™‡∏≠‡∏ö! üéâ'
    );
    
    if (result.success) {
      showResult('notificationResult', '‚úÖ ‡πÅ‡∏™‡∏î‡∏á notification ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏î‡∏π notification ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏à‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 'success');
    } else {
      throw new Error(result.error);
    }

  } catch (error) {
    console.error('‚ùå [RENDERER] Error:', error);
    showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
  }
}

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Agent Login notification
async function testAgentLogin() {
  try {
    console.log('üü¢ [RENDERER] Agent login notification...');
    showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Agent ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'loading');
    
    const result = await window.nativeAPI.notifyAgentEvent(
      'Alice Johnson',
      'login',
      { time: new Date().toLocaleTimeString('th-TH') }
    );
    
    if (result.success) {
      showResult('notificationResult', 'üü¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Agent Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\nAgent Alice Johnson ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success');
    } else {
      throw new Error(result.error);
    }
    
  } catch (error) {
    console.error('‚ùå [RENDERER] Error:', error);
    showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
  }
}

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Call Received notification
async function testCallReceived() {
  try {
    console.log('üìû [RENDERER] Call received notification...');
    showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤...', 'loading');
    
    const result = await window.nativeAPI.notifyAgentEvent(
      'Bob Smith',
      'call_received',
      { 
        callerNumber: '02-123-4567',
        queue: 'Support Queue'
      }
    );
    
    if (result.success) {
      showResult('notificationResult', 'üìû ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\nAgent Bob Smith ‡∏°‡∏µ‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà', 'success');
    }
    
  } catch (error) {
    console.error('‚ùå [RENDERER] Error:', error);
    showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
  }
}

    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Urgent Alert
    async function testUrgentAlert() {
        try {
            console.log('üö® [RENDERER] Urgent alert...');
            showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô...', 'loading');
    
            const result = await window.nativeAPI.showNotification(
            'üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô!',
            '‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô!',
            true // urgent = true
            );
    
            if (result.success) {
            showResult('notificationResult', 'üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ notification ‡πÅ‡∏ö‡∏ö urgent', 'success');
            }
    
        } catch (error) {
         console.error('‚ùå [RENDERER] Error:', error);
            showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
        }
    }

    const { Menu, Tray, nativeImage } = require('electron');

    let tray = null;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á System Tray
    function createTray() {
        console.log('üñ±Ô∏è [MAIN] ‡∏™‡∏£‡πâ‡∏≤‡∏á system tray...');
  
        try {

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á icon (‡πÉ‡∏ä‡πâ built-in icon ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå)
            let trayIcon;
            try {
                trayIcon = nativeImage.createFromPath(path.join(__dirname, 'assets', 'icon.png'));
                if (trayIcon.isEmpty()) throw new Error('Icon file not found');
            } catch {
                // ‡πÉ‡∏ä‡πâ built-in icon ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå
                trayIcon = nativeImage.createEmpty();
            }

            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö macOS
            if (process.platform === 'darwin') {
                trayIcon = trayIcon.resize({ width: 16, height: 16 });
                trayIcon.setTemplateImage(true); // monochrome ‡∏ö‡∏ô macOS
            }

    /*
      1. process.platform === 'darwin'
      ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡∏ö‡∏ô macOS (darwin = ‡∏ä‡∏∑‡πà‡∏≠ kernel ‡∏Ç‡∏≠‡∏á macOS)
      ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Windows/Linux ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ

      2. trayIcon.resize({ width: 16, height: 16 })
      ‡∏ö‡∏ô macOS menubar tray icon ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (16√ó16 px ‡∏´‡∏£‡∏∑‡∏≠ 22√ó22 px)
      ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ icon PNG 256√ó256 ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‚Üí ‡∏à‡∏∞‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏•‡∏≠
      ‡πÄ‡∏•‡∏¢‡∏ï‡πâ‡∏≠‡∏á resize ‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö menubar

      3. trayIcon.setTemplateImage(true)
      ‡∏ö‡∏≠‡∏Å Electron ‡∏ß‡πà‡∏≤ icon ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚ÄúTemplate Image‚Äù ‡∏Ç‡∏≠‡∏á macOS
      macOS ‡∏à‡∏∞:
      ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô monochrome (‡∏Ç‡∏≤‡∏ß/‡∏î‡∏≥) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ icon ‡∏ï‡∏≤‡∏° theme (Light / Dark Mode)
      ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏î‡∏π native ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô app ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
      ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà ‚Üí icon ‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏µ‡πÄ‡∏ï‡πá‡∏° ‡πÜ ‡∏ã‡∏∂‡πà‡∏á‡∏î‡∏π ‚Äú‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö macOS‚Äù
    */
    
            tray = new Tray(trayIcon);
    
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á context menu
            const contextMenu = Menu.buildFromTemplate([
            {
                label: 'üìä ‡πÅ‡∏™‡∏î‡∏á Wallboard',
                click: () => {
                console.log('üìä [TRAY] ‡πÅ‡∏™‡∏î‡∏á wallboard');
                mainWindow.show();
                mainWindow.focus();
                }
            },
            {
                label: 'üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                submenu: [
                {
                    label: 'üü¢ Available',
                    click: () => changeAgentStatusFromTray('Available')
                },
                {
                    label: 'üî¥ Busy', 
                    click: () => changeAgentStatusFromTray('Busy')
                },
                {
                    label: 'üü° Break',
                    click: () => changeAgentStatusFromTray('Break')
                }
                ]
            },
            { type: 'separator' },
            {
                label: '‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',
                click: () => {
                console.log('‚öôÔ∏è [TRAY] ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤');
                // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
                }
            },
            {
                label: '‚ùå ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°',
                click: () => {
                console.log('‚ùå [TRAY] ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°');
                app.quit();
                }
            }
            ]);
    
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ tray
            tray.setContextMenu(contextMenu);
            tray.setToolTip('Agent Wallboard - Desktop App');
    
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å tray icon
            tray.on('click', () => {
            console.log('üñ±Ô∏è [TRAY] ‡∏Ñ‡∏•‡∏¥‡∏Å tray icon');
            if (mainWindow.isVisible()) {
                mainWindow.hide();
            } else {
                mainWindow.show();
                mainWindow.focus();
            }
            });
    
            console.log('‚úÖ [MAIN] System tray ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß');
    
        } catch (error) {
            console.error('‚ùå [MAIN] Error ‡∏™‡∏£‡πâ‡∏≤‡∏á tray:', error);
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å tray
    function changeAgentStatusFromTray(status) {
        console.log('üîÑ [TRAY] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô:', status);
  
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á renderer
        mainWindow.webContents.send('status-changed-from-tray', {
            newStatus: status,
            timestamp: new Date().toISOString()
        });
  
        // ‡πÅ‡∏™‡∏î‡∏á notification
        new Notification({
            title: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
            body: `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${status} ‡πÅ‡∏•‡πâ‡∏ß`,
            icon: path.join(__dirname, 'assets', 'notification.png')
        }).show();
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô createWindow()
    function createWindow() {
        // ... code ‡πÄ‡∏î‡∏¥‡∏° ...
  
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á tray
        createTray();
  
        // ‡∏ã‡πà‡∏≠‡∏ô window ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î X
        mainWindow.on('close', (event) => {
            if (!app.isQuiting) {
            event.preventDefault();
            mainWindow.hide();
      
            // ‡πÅ‡∏™‡∏î‡∏á notification ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ app ‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
            new Notification({
                title: 'Agent Wallboard',
                body: '‡πÅ‡∏≠‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô system tray\n‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà icon ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π'
            }).show();
            }
        });
    }

    // IPC Events ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ Tray ---
    ipcMain.on('hide-to-tray', () => {
        if (mainWindow) {
            mainWindow.hide();
            if (process.platform === 'win32') {
            new Notification({
                title: 'Agent Wallboard',
                body: 'App is still running in the system tray'
            }).show();
            }
        }
    });

    // IPC Events ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ó‡∏µ‡πà Tray ---
    ipcMain.on('show-app', () => {
        if (mainWindow) {
            mainWindow.show();
            mainWindow.focus();
        }
    });

    // ... code ‡πÄ‡∏î‡∏¥‡∏° ...

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î app ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î window ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    app.on('window-all-closed', () => {
          // ‡πÑ‡∏°‡πà quit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ app ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô tray ‡∏ï‡πà‡∏≠‡πÑ‡∏õ
          // app ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°" ‡∏à‡∏≤‡∏Å tray menu
    });

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏∞‡∏õ‡∏¥‡∏î app ‡∏à‡∏£‡∏¥‡∏á‡πÜ
    app.on('before-quit', () => {
          app.isQuiting = true;
    });

    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ tray
function testHideToTray() {
  try {
    console.log('üëÅÔ∏è [RENDERER] ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ tray...');
    showResult('trayResult', 'üëÅÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ system tray...', 'loading');
    
    setTimeout(() => { // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 1 sec.
      // ‡∏£‡∏±‡∏ö event ‡∏ã‡πà‡∏≠‡∏ô system tray
      window.nativeAPI.hideToTray();
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå [RENDERER] Error:', error);
    showResult('trayResult', `‚ùå Error: ${error.message}`, 'error');
  }
}

// ‡πÅ‡∏™‡∏î‡∏á tray
function testShowApp() {
  console.log('üëÅÔ∏è [RENDERER] ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≤‡∏Å tray...');
  
    setTimeout(() => { // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 1 sec.
      // ‡∏£‡∏±‡∏ö event ‡πÅ‡∏™‡∏î‡∏á system tray
      window.nativeAPI.showApp();
    }, 1000);
}

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification ‡∏à‡∏≤‡∏Å tray action
function testTrayNotification() {
  try {
    console.log('üîî [RENDERER] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification ‡∏à‡∏≤‡∏Å tray...');
    showResult('trayResult', 
      '‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö System Tray ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n' +
      'üñ±Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà icon ‡πÉ‡∏ô taskbar/menubar\n' +
      'üìã ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡πà‡∏≤‡∏á‡πÜ\n' +
      'üîÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å tray menu',
      'success'
    );
    
  } catch (error) {
    console.error('‚ùå [RENDERER] Error:', error);
    showResult('trayResult', `‚ùå Error: ${error.message}`, 'error');
  }
}

// ‡∏£‡∏±‡∏ö event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å tray
window.nativeAPI.onStatusChangedFromTray((data) => {
  console.log('üîÑ [RENDERER] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö status change ‡∏à‡∏≤‡∏Å tray:', data);
  
  showResult('trayResult',
    `üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å System Tray!\n\n` +
    `üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà: ${data.newStatus}\n` +
    `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(data.timestamp).toLocaleString('th-TH')}\n\n` +
    `‚úÖ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ communication ‡∏à‡∏≤‡∏Å Main ‚Üí Renderer`,
    'success'
  );
});
  </script>
</body>
</html>